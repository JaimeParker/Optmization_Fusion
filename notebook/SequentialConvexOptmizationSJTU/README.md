# 最优化与最优制导

简答加一个计算（推导公式）

## 1. What is guidance

制导问题的关键词有：

* 轨迹
* 飞行器动力学（主要是平动）
* Select Commands
* 当前状态和期望状态
* 约束

典型的制导问题有：

* Reference trajectory tracking
* Homing guidance (Missile)
* On-line trajectory generation

控制和制导的区别：

| 控制           | 制导           |
| -------------- | -------------- |
| 力和力矩       | 实现机动       |
| 姿态和飞行状况 | 输出给控制单元 |
| 稳定性         | 速度和加速度   |

计算制导：

* 依赖于数值算法
* 依赖于在线计算，对计算机算力有要求
* 基于模型或是基于数据的
* 优化是计算制导一个常用的手段

## 2. Generic Formulation of Trajectory Optimization

计算制导和轨迹优化的关系：

| 计算制导       | 轨迹优化       |
| -------------- | -------------- |
| 决定轨迹       | 选择轨迹       |
| 控制飞行器     | 设计具体机动   |
| 需要考虑约束   | 可以加入约束   |
| 最优性不能保证 | 可以保证最优性 |
| 大多数在线生成 | 可以离线生成   |

==轨迹优化问题的要素==：

* 损失函数，目标函数
* 动力学方程
* 约束（起始点约束，路径约束），等式约束和不等式约束，可以转换

轨迹优化问题的标准形式：

最小化 $u(t),p$：
$$
J=\phi(x(f_t)) + \int_{t_0}^{t_f}L(x(t),u(t),t) {\rm d}t
$$
基于：
$$
\dot{x}(t)=f(x(t),u(t),p,t),\\
h(x(t),u(t),p,t)=0,\\
g(x(t),u(t),p,t)\leq 0
$$

## 3. Discretization Methods

离散方法：

* 单次打靶
* 多次打靶
* 配点法（完全离散）

单次打靶：

* 只调整控制变量，使用变量最少
* 在每个点范围进行完整时间的积分
* 通过对动力学方程的积分，获得状态变量
* 庞大的非线性变量可能导致无法收敛

多次打靶：

* 调整控制变量和一部分状态变量
* 时间分段，每个点不是完整时间积分，而是分段时间积分
* 能够增强对庞大的非线性变量的收敛性

配点法：

* 每一个点的状态和控制变量都离散
* 每个间隔都
* 优化每个点的状态和控制变量
* 稀疏的梯度结构

## 4. Newton-Type Methods in Computational Guidance

使用前向欧拉法，将典型制导问题转化为了，针对特定状态$x_1$，未知量为所有的控制序列，可以通过初始状态求得终端状态；非线性；构造了
$$
G(u)=0
$$
并使用牛顿法求根，此时系统变为线性系统，可以用最小二乘法解决。

在这之中可以使用线搜索等技术加快收敛。

总结，牛顿类方法在计算制导中的应用：

* 无约束或路径约束下的轨迹优化
* 非线性未定系统的求根
* 线搜索
* 最小化控制
* 计算量大
* 损失函数的选择有限

## 6. Sequential Convex Optimization Methods

序列凸优化方法：

* 计算制导
* 非线性轨迹优化问题转换为凸优化问题
* 计算效率高
* 指的是一类方法

**序列凸优化的步骤**：

1. 处理非线性动力学（动力学方程的线性化，单次打靶，前向欧拉法），找到状态增量和控制修正量的关系



**单次打靶**的动力学线性化：

<img src="image/1.png" alt="1" style="zoom:67%;" />

构建完整的$u$到$x$序列的映射矩阵，为下三角矩阵（致密的），完成了线性化。

之后添加约束，转换为二次型问题求解。

可以是固定时间和free time。

如果引入步长：则$B$矩阵多出一列。

**配点法**的动力学线性化：

<img src="image/2.png" alt="2" style="zoom:67%;" />

一种是基于动力学方程的积分量，一种是基于前向欧拉法的更新量，通过若干次迭代使这两个量的差达到收敛要求。

最后根据积分和更新得到的矩阵是稀疏的。

**归一化时间**：

* 时间区间固定为$[0,1]$
* 使用链式法则推导
* 解决最终时间不固定的问题，将一般问题转化为时间固定的最优控制问题

## 7. Trigonometric-polynomial Control Parameterization

普通的优化方法往往导致控制量不平滑（导数不连续）；因此引入三角多项式；构造
$$
u(t)=S_N(t)c
$$
即控制量=基*系数；

**控制量参数化**（三角化）方法：

* 实现将系数约束转化为控制量导数的约束
* 控制量的导数任意阶存在，无限阶平滑
* 优化仅对于系数
* 实现了控制量的平滑变化
* 具有周期性，比较适用于周期性问题

对于初始和终端状态的控制量不为0的问题，可以通过构造特殊函数（类似滤波器）来实现。

总结：

* 使轨迹生成更加平滑
* 可以使用应用数学的工具来解决实际问题

## 8. Sequential Convex Optimization Methods – continued

**单次打靶，前向欧拉法**：引入参数化方法
$$
{\rm d}x_{k+1}= \sum^{k}_{j=1}B_{k,j}[S_N]_j {\rm d}c=(\sum^k_{j=1}D_{k,j}){\rm d}c
$$
状态增量变成系数修正量的函数。

**配点法，前向欧拉：**引入参数化方法

**配点法，梯形法：**引入参数化方法

**控制时间流动：**引入$p$，根据链式法则
$$
\frac{du}{dt}=\frac{du}{dp}\frac{dp}{dt}
$$

* 假设$T_f$固定，则每个离散点的$S_N$只需要计算一次
* 减少计算量
* 适用于过渡过程的后半段，回正过程，使控制量尽量平稳

**松弛化凸约束：**将非凸问题转化为凸问题，牺牲可行域完成对凹集的优化

## 9. Trajectory Optimization Practice











